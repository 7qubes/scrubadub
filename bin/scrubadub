#!/usr/bin/env python
# -*- mode: python -*-
# PYTHON_ARGCOMPLETE_OK

import argparse
import os
import sys

import argcomplete

import scrubadub
from scrubadub.exceptions import CommandLineError
from scrubadub.colors import red

# initialize the parser
parser = argparse.ArgumentParser(
    description=(
        'Command line tool for scrubbing personal information from raw text.'
    ) % locals(),
)

# define the command line options here
parser.add_argument(
    'input', nargs='?', type=argparse.FileType('r'), default='-',
    help='Input of dirty dirty text.',
).completer = argcomplete.completers.FilesCompleter
parser.add_argument(
    '-o', '--output', type=argparse.FileType('w'), default='-',
    help='Output of pristinely clean text.',
)
parser.add_argument(
    '-v', '--version', action='version', version='%(prog)s '+scrubadub.VERSION,
)

# enable autocompletion with argcomplete
argcomplete.autocomplete(parser)

# parse the command line arguments and run the script
args = parser.parse_args()
try:
    result = scrubadub.clean(args.input.read())
except CommandLineError as ex:
    sys.stderr.write(red(ex) + '\n')
    sys.exit(1)
else:
    args.output.write(result)
